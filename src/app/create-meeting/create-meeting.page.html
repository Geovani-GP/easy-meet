<ion-header>
  <app-spinner></app-spinner>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab1"></ion-back-button>
    </ion-buttons>
    <ion-title>{{translate('crear-reunion')}}</ion-title>
  </ion-toolbar>
  <ion-spinner></ion-spinner> 
</ion-header>

<ion-content>
  <form (ngSubmit)="onSubmit()">
    <ion-item>
      <ion-label position="floating">{{translate('titulo')}}</ion-label>
      <ion-input [(ngModel)]="titulo" name="titulo" required></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">{{translate('descripcion')}}</ion-label>
      <ion-textarea [(ngModel)]="descripcion" name="descripcion" required></ion-textarea>
    </ion-item>

    <div class="fecha">
      <h2 class="easy-meet-title">{{translate('fecha')}}</h2>
      <p (click)="showDatePicker()">{{ selectedDate | date: 'dd MMMM yyyy HH:mm ' }}</p>
      <div class="modal" *ngIf="isDatePickerVisible">
        <ion-datetime 
          [(ngModel)]="selectedDate" 
          (ionChange)="onDateChange($event)"
          displayFormat="MMM DD YYYY HH:mm"
          pickerFormat="MMM DD YYYY HH:mm"
          name="fecha">
        </ion-datetime>
        <!-- Botón para aceptar la selección -->
        <ion-button expand="full" (click)="acceptDate()">{{translate('aceptar')}}</ion-button>
      </div>
    </div>

    <ion-item>
      <ion-label position="floating">{{translate('costo')}}</ion-label>
      <ion-input type="number" [(ngModel)]="costo" name="costo" required></ion-input>
    </ion-item>

    <ion-item>
      <ion-label>{{translate('tipo')}}</ion-label>
      <ion-select [(ngModel)]="tipo" name="tipo" placeholder="{{translate('selecciona-un-tipo')}}" required>
        <ion-select-option value="1">{{translate('comercial')}}</ion-select-option>
        <ion-select-option value="2">{{translate('cultural')}}</ion-select-option>
        <ion-select-option value="3">{{translate('festejo')}}</ion-select-option>
        <ion-select-option value="4">{{translate('recreativo')}}</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label>{{translate('tema')}}</ion-label>
      <ion-select [(ngModel)]="tema" name="tema" placeholder="{{translate('selecciona-un-tema')}}" required>
        <ion-select-option *ngFor="let interes of intereses" [value]="interes.id">{{interes.name}}</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <h1 class="easy-meet-title">{{translate('edad')}}: {{ rangeValues.lower }} - {{ rangeValues.upper }}</h1>
      <ion-range 
        aria-label="Dual Knobs Range" 
        [dualKnobs]="true" 
        [(ngModel)]="rangeValues" 
        name="rangeValues" 
        (ionChange)="updateValues()">
      </ion-range>
    </ion-item>

    <ion-item>
      <ion-label>{{translate('subir-imagen')}}</ion-label>
      <ion-button fill="outline" slot="end" (click)="openCamera()">
        <ion-icon name="camera"></ion-icon>
      </ion-button>
    </ion-item>

    <ng-container *ngIf="isLoading | async">
      <app-spinner></app-spinner>
    </ng-container>

    <ng-container *ngIf="myObservable$ | async as imageUrl">
      <div *ngIf="imageUrl; else noImage">
        <ion-item>
          <ion-thumbnail slot="start">
            <img [src]="imageUrl" alt="Imagen subida" (click)="viewImage(imageUrl)">
          </ion-thumbnail>
          <ion-label>
            <h2>{{translate('imagen-subida')}}</h2>
          </ion-label>
        </ion-item>
       <!--  <div class="preview-container">
          <img [src]="imageUrl" alt="Vista previa" style="max-width: 100%; height: auto;">
        </div> -->
      </div>
      <ng-template #noImage>
        <ion-item>
          <ion-thumbnail slot="start">
            <img src="../../assets/no-image.png" alt="No hay imagen">
          </ion-thumbnail>
          <ion-label>
            <h2>{{translate('no-hay-imagen')}}</h2>
          </ion-label>
        </ion-item>
      </ng-template>
    </ng-container>

    <ion-item>
      <ion-label position="floating" class="easy-meet-title">{{translate('direccion')}}</ion-label>
      <br>
      <p (click)="showMapModal()">{{ direccion || translate('selecciona-una-direccion') }}</p>
    </ion-item>

    <ion-button expand="full" color="primary" type="submit">{{translate('registrar')}}</ion-button>
  </form>

  <ion-modal [isOpen]="isMapModalOpen" (ionDidPresent)="onMapModalDidPresent()" (ionDidClose)="isMapModalOpen = false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{translate('seleccionar-ubicacion')}}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="isMapModalOpen = false">{{translate('cerrar')}}</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-item>
          <ion-label position="floating" class="easy-meet-title" style="margin-bottom: 20px;">{{translate('direccion')}}</ion-label>
          <ion-textarea [(ngModel)]="direccion" placeholder="{{translate('escribe-la-direccion')}}" (ionInput)="buscarDireccion()"></ion-textarea>
        </ion-item>
        <ion-list *ngIf="sugerencias.length > 0">
          <ion-item *ngFor="let sugerencia of sugerencias" (click)="seleccionarSugerencia(sugerencia)">
            {{ sugerencia.description }}
          </ion-item>
        </ion-list>
        <div id="map" style="height: 70vh; width: 100%;"></div>
        <ion-button expand="full" (click)="guardarDireccion()">{{translate('guardar-direccion')}}</ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>
  
 

</ion-content>
